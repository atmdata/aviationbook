---
title: Trajectories
output-file: trajectories
---

A trajectory is a mathematical abstraction used to describe the evolution of a moving object with a finite list of parameters. The most common features in aviation include latitude, longitude, altitude, all indexed by time, with first derivatives such as ground speed, track angle and vertical rate.

Depending on the application, some models would expect more features. For example, [aircraft performance models](24-aircraft-performance.qmd) could require the pitch, roll and yaw angles, the true air speed, the indicated air speed, the Mach number, etc.

This chapter describes several common formats for trajectories depending on available technology to record them. Associated data sources come with different licensing terms which must be kept in mind when developing or applying computing methods.

## Aircraft trajectories

### Radar tracks {-}

The concept of **primary surveillance radars (PSR)** is fairly simple: it is a rotating radio transponder with an omnidirectional antenna. Commonly, the radar transmits a one-microsecond pulse for every one millisecond and listens to the reflections from the aircraft. The **position of the aircraft** is measured by the distance and angle to the radar. The distance is known as the *slant distance*, which is the line-of-sight distance between an aircraft and the radar. It can be calculated by measuring the time difference between the original signal and the reflection received, since the speed of the radio wave (speed of light) is known. The *azimuth angle* of the aircraft is determined by the rotation angle of the radar.

The slant distance of an aircraft does not always correspond to the horizontal distance to the radar. Since the civil radar usually does not provide elevation information on the target, it is not possible to accurately convert the slant distance to the horizontal distance. Historically, it is sufficient to use primary radar for separating aircraft without considering these altitude differences. However, [other systems](#mode-s) have been put in place to provide air traffic controllers more accurate altitudes of the aircraft.

:::{.callout-important}
**Air navigation service providers (ANSP)** own the data produced by the surveillance radar installations they operate.
:::

Radar tracks have a prestigious aura for obvious coverage reasons. However, it is rather unlikely that you gain access to radar trajectories on a systematic basis. Moreover, on international flights, getting a full trajectory would require agreements with ANSPs of all countries aircraft have flown.

In general, trajectories based on radar plots produced by computer systems contain an identifier, timestamps, latitudes, longitudes, altitudes, ground speed, vertical speed and track angle. **Kalman filters** help to smoothen trajectories and compute the derivatives.


### ADS-B {-}

ADS-B stands for *Automatic Dependent Surveillance--Broadcast*. It is probably one of the most well-known source of aircraft trajectories, popularized by famous websites such as [Flightradar24](https://www.flightradar24.com) or [The OpenSky Network](https://www.opensky-network.org). It is a surveillance technology designed to allow aircraft to broadcast their flight state periodically without the need for interrogation.

The word *automatic* refers to the fact that no inputs from controllers or pilots are required. The word *dependent* indicates this technology depends on information from other onboard systems, such as air data systems and navigation systems.


:::{.callout-important}
Messages do not contain any timestamp information. Timestamps are usually appended by receiver of the messages, based on the reception time (and not the time of emission by the aircraft).
:::

Information broadcast in ADS-B messages contains, in addition to a unique [24-bit transponder code](#aircraft-information), named `icao24` in examples below:

- *identification information*: the *callsign* (an 8-character *non-unique* identifier of the mission or the route of the aircraft) and the wake vortex category;
- *positional information*: latitude and longitude in degrees (encoded in CPR format), barometric altitude (converted to ISA equivalent), and GPS altitude in feet;
- *velocity information*: track angle in degrees, ground speed in knots, vertical rate in feet per minute;
- *uncertainty information* around the position and the velocity of the aircraft.

Positional and velocity information is computed by the aircraft based on GNSS and inertial navigation systems of the aircraft.


:::{.callout-warning}
There is a common confusion in aviation between three designations for angles:

- the **track angle** represents the direction the aircraft is flying. It is the angle of the speed vector, ranging from 0 (North) to 360 degrees (90° for East, 270° for West);
- the **heading angle** represents the direction the nose the aircraft is pointing at;
- the **bearing angle** usually represents the direction of/to a static object, e.g., the bearing of a runway, or the bearing to a navigational point.
:::

:::{.callout-note}
## A note about callsign identifiers

A callsign is an eight-character identifier used for communication with the ATC.

General aviation commonly uses the aircraft registration (tail number) as a callsign; commercial flights use a (often unique) identifier per route, starting with three letters identifying the airline operator, `BAW` (*pronounce "speedbird"*) for British Airways, `AFR` for Air France, etc.

Outside commercial aviation, the callsign commonly refers to the mission operated by an aircraft, and this can help distinguish the original intention of an aircraft used for specific purposes.

For example, aircraft `F-HNAV` uses the `CALIBRA` callsign for flight inspection and VOR/ILS calibration operations, the `JAMMING` callsign during jamming investigation and a more regular `NAK` callsign when commuting between airfields.

Similarly, test flights operated by Airbus use an `AIB` callsign; Boeing uses a `BOE` callsign; ambulance helicopters often use explicit callsigns: `SAMU` in France (stands for *Urgent Medical Aid Service*) and `LIFE` in many European countries.

Australian firefighting operations use a specific callsign depending on the role of the aircraft during the operations: `BMBR` for firebombing; `SPTR` for fire spotters; `BDOG`, *bird dog*, for fire attack supervisions (often subcontracted); and `FSCN`, fire scan for remote sensing fire operations.
:::

Even though all information is not available at each timestamp, tabular data (csv) is a common format to represent trajectory data. In this example, the `icao24` code `7c4779` matches a Qantas Boeing B747 registered as `VH-OEJ`.

```{ojs}
//| echo: false
import { Flight } from "@xoolive/traffic-js"
```

```{ojs}
//| echo: false
url = "https://raw.githubusercontent.com/xoolive/traffic/master/traffic/data/samples/featured/qantas747.json.gz"
qantas747 = Flight.fromURL(url)
qantas747.table()
```

This tabular information can easily be represented on a map, or as a regular plot for non-geographical features.

```{ojs}
//| echo: false
{
  const container = html`<div style="height: 400px;">`;
  yield container;
  qantas747.map(container, { zoom: 7, latitude: -33.5, longitude: 152.5 });
}
```

---

```{ojs}
//| echo: false
Plot.plot({
  marks: [
    Plot.line(qantas747.data, {
      x: "timestamp",
      y: "altitude",
      stroke: "steelblue",
    })
  ],
  x: {
    tickFormat: d3.utcFormat("%H:%M"),
    label: "timestamp (UTC)"
  },
  y: {
    label: "altitude (in feet)"
  },
  marginLeft: 50,
  width,
  height: 200,
  grid: true
})
```


:::{.callout-note}
## What broadcasting means

The letter "B" in ADS-B means *broadcast*: aircraft broadcast messages at the same rate regardless of ground equipments and infrastructure, even if no aircraft or receiver is within range. Aircraft broadcast ADS-B data even over oceans, poles, or deserted areas.

Recently, "Space-based ADS-B" has been implemented so that a constellation of low-altitude satellites attempts to receive and decode ADS-B messages from aircraft in the troposphere and forward positional information to ground-based stations. There have been high expectations around this technology which is expected to revolutionarize traditional air traffic management over areas such as the North-Atlantic Ocean, controlled by Shannon (Ireland) and Gander (Canada) ACCs.
:::


:::{.callout-tip}
A lot of details about the contents of ADS-B messages, Mode S data and their decoding is detailed in a different book, *The 1090 Megahertz Riddle* @sun1090.
:::

### Mode S {-}

The **secondary surveillance radar (SSR)**, also known as the air traffic control radar beacon system (ATCRBS), was designed to provide air traffic controllers more information than what is provided by the primary radar. The secondary radar can be installed separately or installed on top of the primary radar. It uses a different radio frequency to actively interrogate the aircraft and receive information transmitted by the aircraft.

The SSR transmits interrogations using the 1030 MHz radio frequency and the aircraft transponder transmits replies using the 1090 MHz radio frequency. In the early design of SSR, two civilian communication protocols (Mode A and Mode C) were introduced. Mode A and Mode C respectively allow the SSR to continuously interrogate the **identity (squawk code)** and the **altitude** of an aircraft. The **squawk code** in Mode A is a unique 4-octal digit code given by air traffic controllers to aircraft in their flight information region (FIR) for identification. The altitude in Mode C refers to the barometric altitude obtained from the aircraft’s air data system.

:::{.callout-tip}
Some squawk codes are reserved for particular emergency situations:

- 7500 for hijacking situations;
- 7600 for radio failures;
- 7700 for general emergencies @opensky20.
:::

**Mode S (Mode Select Beacon System)** was designed by Lincoln Laboratory at Massachusetts Institute of Technology in the 1970s. Based on different iterations of hardware and software design in the 1980s, the implementation of Mode S in air traffic control began in the 1990s. Since then, Mode S has become one of the main sources for aircraft surveillance.

The main characteristic of Mode S is its **selective interrogation**, which allows the SSR to interrogate different information from different aircraft separately.  Unlike the limited number (4096) of unique identification codes in Mode A communication, the Mode S transponder is identified by a [24-bit transponder code](#aircraft-information), which can support up to $2^{24} =$ 6,777,216 unique addresses.

:::{.callout-important}
As Mode S consists in selective interrogation, it is strongly dependent on ground infrastructure around. Mode S messages are only sent in reply to an interrogation, therefore **no such data can be expected from an aircraft out of range of an SSR**, over the ocean, poles or deserted areas.
:::

The Mode S uplink signal contains parameters that indicate which information is desired by the air traffic controller. Many downlink formats (DF) are described in the Mode S protocol in order to reply to such information:

-  **Altitude and identity replies (DF 4/5)** are rough equivalents to Mode A/C protocols;

-  **All-call reply (DF 11)** is the reply sent by Mode S compliant transponders to queries addressed to Mode A/C capable transponders. It contains the [24-bit transponder code](#aircraft-information), the transponder capabilities @sun20capab, and the interrogator identifier;

-  **ACAS short and long replies (DF 0/16)**: **Airborne Collision Avoidance System (ACAS)** is a system designed to reduce the risk of mid-air collisions and near mid-air collisions between aircraft. In particular **Resolution Advisories (RA)** generate particular messages (DF16) which can be used to find about past RA alerts @opensky19.\
   Details of the protocol are described [here](https://mode-s.org/decode/content/mode-s/4-acas.html).

-  **Comm-B, with altitude and identity replies (DF 20/21)**


![An overview of all Mode S services, excerpt from [www.mode-s.org](https://mode-s.org/decode/content/introduction.html#summary) @sun1090](images/mode_s_services.png)

### FLARM {-}

868 MHz

### UAT {-}

**Universal Access Transceiver (UAT)** on 978 MHz

## Aircraft information

A number of flight information is usually not directly accessible from settings recording aircraft trajectories. Metadata usually refers to any additional information enriching a trajectory.
Enriching trajectories with relevant information is usually a costly process, and access to such information can be complicated.


The most common identifier for aircraft in radar based technologies would be the identifier of the transponder: a six-digit hexadecimal identifier which classically identifies an aircraft. Useful metadata would include

| feature      | description                                   |
| ------------ | --------------------------------------------- |
| registration | The tail number of an aircraft, e.g. `F-HNAV` |
| typecode     | The aircraft type, e.g. `A321`                |
| age          |                                               |
| owner        |                                               |
| manufacturer |                                               |
| operator     |                                               |

: Aircraft identifier and metadata {#tbl-cucu}

::: {.callout-warning}
**TODO**

- equivalence between N-codes and icao codes
- icao ranges per country, tail number patterns per country

:::



Metadata associated with callsigns (and posssibly dates) include:

| feature  | description                                      |
| -------- | ------------------------------------------------ |
| callsign | the ICAO code, e.g. `AFR82BY`                    |
| number   | the commercial IATA flight number, e.g. `AF6103` |
| ADEP     | aeroport of departure, e.g. `LFBO`               |
| ADES     | aeroport of destination, e.g. `LFPO`             |
| EOBT     | estimated off-block time                         |
| ETOT     | estimated take-off time                          |

## Flight parameters

### Quick Access Recorders (QAR)

Aircraft carry an airborne flight recorder to provide quick access to raw flight data. Use cases for such data range from flight operational quality assurance (FOQA), post-ops analysis to improve flight safety or operational efficiency, system analysis for predictive or condition-based maintenance. QAR data typically contains over 2000 flight parameters.


![Example of a subset of QAR data for an A320 aircraft](images/qar_screenshot.png){#fig-qar-a320}


::: {.callout-warning}
Trajectory records usually have a different sampling rate depending on the feature. IEEE354 defines a particular floating point number called `NaN` (not a number) useful for marking missing values. Integers usually do not have such equivalent, so it is common to find *saturated values* (255 for 8-bit integers) to mark missing values.
:::

::: {.callout-important}
Airlines, not manufacturers, own the data of the aircraft they operate. These days, manufacturers tend to sell cloud services to store and analyse data of the aircraft they sell.
:::

## Flight plans

Example: N0441F340 FISTO5B FISTO UY156 PERIG UT210 TUDRA/N0426F280 UT158 AMB AMB9W


## Flight lists

### DDR2 `exp2`

The traffic demand file (exp2) can obtained from the EUROCONTROL’s Demand Data Repository
(DDR2) for a selected period of time (typically one day) and geographic area (e.g. FABEC).
The `exp2` includes, for each flight, basic information about the departure time,
the origin and destination airports, a unique flight identifier, the callsign,
the aircraft ICAO code (e.g. A320) and the requested flight level by the airspace user as
submitted in the flight plan.

### OSN Flight Table

::: {.callout-note}
Why not?
:::

## Flight trajectories

EUROCONTROL's Network Manager has devised different flight trajectories
formats in order to store and exchange information with the aviation community.

In the following sections we will cover the most known ones: M1 & M3 and SO6.

They are a mix of flight information and trajectory.

### Model 1 (M1 or *FTFM*)

The flight trajectory known as *Model 1*, *M1* or *Filed Tactical Flight Model (FTFM)* is a
mathematical model containing a point and airspace volume profile created in ETFMS for a flight.
This trajectory is first created when Flight Plan (FP) details, and any subsequent changes,
are received by the Network Operations of EUROCONTROL's
Network Manager^[Aircraft Operators (AO) willing to fly IFR flights in the Network Manager (NM)
area of responsibility are mandated to file the relevant Flight Plan to the Network Manager.
The aim of this centralised management of FP's in Europe is linked to one of the NM mandates, i.e.
the ability to detect imbalance between demand (willingness to fly by AO's) and
offer (ability to guarantee safety by ATC / airport capacity providing an adequate level of safety).
The NM provides the ACC's/airports to monitor the situation and implement measures to resolve
the overload (typically via departure delays or rerouting.)].

The M1 is a translation of a FP (especially Field 15) to a point profile, i.e. a
sequence of 4D positions (timestamp + longitude, latitude, altitude) plus relevant penetrated airspace ID's,
calculated taking into account the aircraft type performance (via BADA) and the environment restrictions
as published in the [Route Availability Document (RAD)][rad].

[rad]: https://www.nm.eurocontrol.int/RAD/ "Rote Availability Document (RAD)"

:::{.callout-note}
**TODO**

1. add CSV file with sample M1 data in `data/` folder
1. Add small sample of data frame for M1
2. Plot M1
:::


### Model 2 (M2 or *RTFM*)

### Model 3 (M3 or *CTFM*)

The flight trajectory known as *Model 3*, *M3* or *Current Tactical Flight Model (CTFM)* is an
updated version of the M1 model where the point/airspace profile is recalculated taking into account
surveillance data (*Correlated Position Reports* [CPR]^[CPRs are received by NM from ACC's,
they consist of surveillance data (callsign longitude, latitude, altitude, timestamp) paired
with flight plan info (aircraft type, ICAO 24-bit address)] or more recently
ADS-B position reports)
when these show a significant deviation from M1 (or M2 which is an M1-like
trajectory calculated in case of delayed flight).
The deviation considered is of 1 min in time, more than 400 feet in en-route phase,
more than 1000 feet in climb/descent phase or more than 10 NM laterally,
see 14.3.1 [@niarchakou_simonselva17].

::: {.callout-note}
**TODO**

1. add CSV file with sample M3 data in `data/` folder
1. Add small sample of data frame for M3
2. Plot M3 and M1/M3 overlapped to show the differences
:::

### SO6

### ALL_FT+

:::{.callout-note}
TODO this part could help?
:::

Data for a trajectory refer typically to a point profile and can
include:

* flight ID / flight number / callsign
* sequence number
* timestamp
* position (longitude, latitude, altitude)
* position ID (i.e. published point ID)
* airspace ID
* (ground / vertical) speed

with timestamp and position as a minimum.
